<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aè‚¡ç­–ç•¥åˆ†æå·¥å…·</title>
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen;
      padding: 2em;
    }
    h1 { color: #90caf9; }
    input, textarea, button {
      background: #1e1e1e;
      color: #fff;
      border: 1px solid #333;
      padding: 10px;
      font-size: 1em;
      margin-top: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background: #2196f3;
      border: none;
      cursor: pointer;
      margin-top: 1em;
    }
    button:hover {
      background: #42a5f5;
    }
    #result {
      margin-top: 2em;
      background: #1e1e1e;
      border: 1px solid #333;
      padding: 1em;
      border-radius: 5px;
    }
    @media (max-width: 600px) {
      body { padding: 1em; }
    }
  </style>
</head>
<body>
  <h1>ğŸ“Š Aè‚¡ç­–ç•¥åˆ†æå·¥å…·</h1>
  <p>è¯·è¾“å…¥ä¸€ä¸ªæˆ–å¤šä¸ªè‚¡ç¥¨ä»£ç ï¼ˆç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼Œå¦‚ <code>600519,000858</code>ï¼‰ï¼š</p>
  <textarea id="codeInput" rows="3" placeholder="600519,000858"></textarea>
  <button onclick="fetchStocks()">æŸ¥è¯¢</button>

  <div id="result"></div>

  <script>
    async function fetchStocks() {
      const input = document.getElementById("codeInput").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "æŸ¥è¯¢ä¸­...";

      const codes = input.split(',').map(c => c.trim()).filter(Boolean);
      if (codes.length === 0) return resultDiv.innerHTML = 'âš ï¸ è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªè‚¡ç¥¨ä»£ç ã€‚';

      let output = "";
      for (const code of codes) {
        output += `<h3 style='color:#4fc3f7;'>${code} åˆ†æç»“æœï¼š</h3>`;
        try {
          const res = await fetch(`/analyze?stock_code=${code}`);
          if (!res.ok) throw new Error("æœåŠ¡å“åº”å¤±è´¥æˆ–è‚¡ç¥¨ä»£ç æ— æ•ˆã€‚");
          const data = await res.json();
          output += renderResult(data);
        } catch (err) {
          output += `<span style='color:red;'>âŒ ${err.message}</span><br/>`;
        }
      }
      resultDiv.innerHTML = output;
    }

    function renderResult(data) {
      return `
        <ul>
          <li>ğŸ“Œ è‚¡ç¥¨åç§°ï¼š<b>${data["è‚¡ç¥¨åç§°"]}</b> (${data["è‚¡ç¥¨ä»£ç "]})</li>
          <li>ğŸ’° å½“å‰æ”¶ç›˜ä»·ï¼š${data["æ”¶ç›˜ä»·"]}</li>
          <li>ğŸ” 38.2% å›æ’¤ä½ï¼š${data["38.2%å›æ’¤ä½"]} â†’ <b>${data["æ”¶ç›˜å¤§äº38.2"] ? 'âœ… çªç ´' : 'âŒ æœªçªç ´'}</b></li>
          <li>ğŸ“ˆ MA20 å‡çº¿ï¼š<b>${data["æ”¶ç›˜å¤§äºMA20"] ? 'âœ… å·²ç«™ä¸Š' : 'âŒ æœªç«™ä¸Š'}</b></li>
          <li>ğŸ“Š æ”¾é‡åˆ¤æ–­ï¼š<b>${data["æ”¾é‡ä¸Šæ¶¨"] ? 'âœ… æ”¾é‡ä¸Šæ¶¨' : 'âŒ æ— æ˜æ˜¾æ”¾é‡'}</b></li>
          <li>ğŸ§± Kçº¿å½¢æ€ï¼š${data["Kçº¿å½¢æ€"] || 'æ— æ˜æ˜¾å½¢æ€'}</li>
          <li>ğŸ“‰ RSIï¼š${data["RSIå€¼"]} â†’ <b>${data["RSIå€¼"] > 30 ? 'âœ… å¥åº·' : 'âŒ è¶…å–'}</b></li>
          <li>âš¡ MACD é‡‘å‰ï¼š<b>${data["MACDé‡‘å‰"] ? 'âœ… æ˜¯' : 'âŒ å¦'}</b></li>
          <li>âœ… å»ºè®®ä¹°å…¥ï¼š<b style='color:${data["å»ºè®®ä¹°å…¥"] ? "#4caf50" : "#f44336"};'>${data["å»ºè®®ä¹°å…¥"] ? 'æ˜¯' : 'å¦'}</b></li>
        </ul>
        <hr style="border-color:#333;" />
      `;
    }
  </script>
</body>
</html>
